{
  "datapoint_id": "query_bank_top_failure_transaction_types_001",
  "type": "Query",
  "name": "Top Transaction Types Driving Failures",
  "owner": "risk-analytics@example.com",
  "tags": [
    "fintech",
    "failed_transactions",
    "txn_type",
    "drivers",
    "risk"
  ],
  "metadata": {
    "source": "fintech-seed",
    "grain": "transaction_type_failure_aggregation",
    "exclusions": "Includes only transaction types with at least one declined transaction.",
    "confidence_notes": "Validated against seeded transaction_type distribution and status mix."
  },
  "sql_template": "SELECT\n    bt.txn_type,\n    COUNT(*) AS total_transactions,\n    COUNT(*) FILTER (WHERE bt.status = 'declined') AS failed_transactions,\n    ROUND(\n        100.0 * COUNT(*) FILTER (WHERE bt.status = 'declined') / NULLIF(COUNT(*), 0),\n        2\n    ) AS failed_rate_pct\nFROM public.bank_transactions bt\nWHERE bt.business_date >= CURRENT_DATE - ({lookback_days} * INTERVAL '1 day')\nGROUP BY bt.txn_type\nHAVING COUNT(*) FILTER (WHERE bt.status = 'declined') > 0\nORDER BY failed_transactions DESC, failed_rate_pct DESC\nLIMIT {top_n};",
  "parameters": {
    "lookback_days": {
      "type": "integer",
      "required": false,
      "default": 30,
      "description": "Number of days included in analysis."
    },
    "top_n": {
      "type": "integer",
      "required": false,
      "default": 3,
      "description": "Number of top failure-driving transaction types."
    }
  },
  "description": "Ranks transaction types by failed transaction volume and failure rate.",
  "validation": {
    "expected_columns": [
      "txn_type",
      "total_transactions",
      "failed_transactions",
      "failed_rate_pct"
    ],
    "max_rows": 20
  },
  "related_tables": [
    "public.bank_transactions"
  ]
}
