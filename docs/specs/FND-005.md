# FND-005: Retrieval and Source Trace Observability

**Initiative ID:** FND-005  
**Status:** In Progress  
**Phase:** Phase A (Foundation Stabilization)  
**Last Updated:** 2026-02-20

---

## 1. Problem

When answers are wrong, the team lacks complete retrieval traces to explain source selection and ranking decisions. Debugging is slow and often speculative.

## 2. Scope

In scope:

- Capture retrieval traces for selected and rejected evidence.
- Surface trace metadata in API responses and debug views.
- Persist traces with identifiers that map to request/session context.

Out of scope:

- Full distributed tracing backend migration.
- Automatic correction based on trace anomalies.

## 3. Proposed Design

- Standardize retrieval trace schema (source, tier, score, reason).
- Attach trace IDs to answers and telemetry events.
- Add debug tooling/CLI pathways to inspect traces quickly.

## 4. API and Contract Changes

- Extend response envelope with retrieval trace references.
- Add optional debug endpoint for full trace retrieval.

## 5. Data Model and Storage Changes

- Persist trace records with retention policy.
- Index traces by request_id, conversation_id, and datapoint_id.

## 6. Safety and Policy

- Redact sensitive fields from stored traces by default.
- Enforce retention and access controls for trace payloads.

## 7. Acceptance Criteria

Functional:

- [ ] Every retrieval-backed answer has an inspectable trace reference.
- [ ] Trace lookup returns selected source path and scoring rationale.

Quality:

- [ ] Trace capture overhead stays within approved latency budget.
- [ ] Debug views are deterministic for repeated fixture runs.

## 8. Test Plan

- unit: trace schema generation and redaction tests.
- integration: end-to-end answer generation with trace persistence and lookup.
- manual: triage wrong-answer scenarios using trace tools only.

## 9. Rollout and Rollback

Rollout:

- Enable trace capture in shadow mode first, then expose in response envelope.

Rollback:

- Disable trace persistence while keeping in-memory summary for diagnostics.

## 10. Open Questions

- What retention window balances debugging value vs storage cost?
- Should full trace access be role-gated by environment?
