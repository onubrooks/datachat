# SMP-002: Deterministic Simplicity Package

**Initiative ID:** SMP-002  
**Status:** Planned  
**Phase:** Phase B (Simplicity and Platform Expansion)  
**Last Updated:** 2026-02-20

---

## 1. Problem

Repeated KPI and operational questions should execute via deterministic templates/functions for speed and consistency, but current runtime primarily relies on freeform generation.

## 2. Scope

In scope:

- Add deterministic template/function execution lane for known intents.
- Provide embedding/integration-friendly surface for deterministic calls.
- Define deterministic-first routing policy with fallback controls.

Out of scope:

- Full dynamic planning loops.
- Fully autonomous template discovery without review.

## 3. Proposed Design

- Introduce template registry with parameter schemas and validation.
- Route matched intents to deterministic lane before freeform SQL generation.
- Add deterministic route telemetry and eval coverage.

## 4. API and Contract Changes

- Add template execution contract (template_id, params, target_database).
- Extend response metadata with deterministic route markers.

## 5. Data Model and Storage Changes

- Store template metadata and versioned SQL variants.
- Persist template execution outcomes for quality monitoring.

## 6. Safety and Policy

- Validate all parameters and enforce target-database policy constraints.
- Require fallback reason codes when deterministic execution is skipped.

## 7. Acceptance Criteria

Functional:

- [ ] Supported repeated intents execute through deterministic template lane.
- [ ] Deterministic route falls back gracefully with explicit reason metadata.

Quality:

- [ ] Deterministic lane improves latency and consistency metrics on benchmark set.
- [ ] Eval suites cover deterministic route correctness and fallback behavior.

## 8. Test Plan

- unit: template parameter validation and route matcher tests.
- integration: deterministic execution plus fallback scenarios across engines.
- manual: benchmark recurring business prompts with/without deterministic lane.

## 9. Rollout and Rollback

Rollout:

- Enable deterministic lane for a small intent subset, then expand by confidence.

Rollback:

- Disable deterministic route gate and return to freeform-only behavior.

## 10. Open Questions

- What minimum confidence threshold should trigger deterministic route?
- How should template ownership and lifecycle be governed?
